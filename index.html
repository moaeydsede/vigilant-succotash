<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Evaluation โ CRM Score</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <button class="icon-btn" id="btnMenu" aria-label="ุงููุงุฆูุฉ">
        <span class="hamburger" aria-hidden="true"></span>
      </button>
      <div class="brand">
        <div class="brand-title">Customer Evaluation</div>
        <div class="brand-sub">CRM Score</div>
      </div>
      <div class="top-actions">
        <button class="chip" id="btnRefresh">ุชุญุฏูุซ</button>
        <button class="chip" id="btnLogout" hidden>ุฎุฑูุฌ</button>
      </div>
    </header>

    <aside class="drawer" id="drawer" aria-hidden="true">
      <div class="drawer-head">
        <div class="drawer-title">ุงููุงุฆูุฉ</div>
        <button class="icon-btn" id="btnCloseDrawer" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <nav class="drawer-nav">
        <button class="nav-item active" data-route="customers">๐ฅ ุงูุนููุงุก</button>
        <button class="nav-item" data-route="transactions">๐งพ ุงูุญุฑูุงุช</button>
        <button class="nav-item" data-route="invoices">๐ ุงูููุงุชูุฑ</button>
        <button class="nav-item" data-route="company">๐ข ุจูุงูุงุช ุงูุดุฑูุฉ</button>
        <button class="nav-item" data-route="users" id="navUsers" hidden>๐ค ุงููุณุชุฎุฏููู</button>
        <button class="nav-item" data-route="tools">๐งฐ ุงุณุชูุฑุงุฏ/ุชุตุฏูุฑ</button>
        <button class="nav-item" data-route="about">โน๏ธ ุญูู</button>
      </nav>

      <div class="drawer-foot">
        <div class="small muted">ูุงุฌูุฉ ููุจ ุฎูููุฉ + Firestore</div>
      </div>
    </aside>

    <main class="content">
      <section class="view active" id="view-login">
        <div class="login-wrap">
          <div class="login-card">
            <div class="login-title">ุชุณุฌูู ุงูุฏุฎูู</div>
            <div class="login-sub muted">Customer Evaluation โ CRM Score</div>

            <div class="grid2" style="margin-top:14px">
              <div class="field" style="grid-column:1/-1">
                <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                <input id="authEmail" type="email" autocomplete="username" placeholder="name@example.com" />
              </div>
              <div class="field" style="grid-column:1/-1">
                <label>ูููุฉ ุงููุฑูุฑ</label>
                <input id="authPass" type="password" autocomplete="current-password" placeholder="โขโขโขโขโขโขโขโข" />
              </div>
              <div class="row" style="grid-column:1/-1; justify-content:space-between; gap:10px">
                <button class="btn" id="btnLogin">ุฏุฎูู</button>
                <button class="btn ghost" id="btnShowRegister">ุฅูุดุงุก ุญุณุงุจ</button>
              </div>
              <div class="muted small" id="authMsg" style="grid-column:1/-1"></div>
            </div>

            <div class="muted small" style="margin-top:12px; line-height:1.7">
              ุนูุฏ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ุณูุชู ุญูุธู ูู <b>Viewer</b> ุชููุงุฆููุงุ ููููู ููู <b>Admin</b> ุชุบููุฑ ุงูุตูุงุญูุฉ ูุงุญููุง.
            </div>
          </div>
        </div>
      </section>

      <section class="view" id="view-users">
        <div class="page-head">
          <h1>ุงููุณุชุฎุฏููู</h1>
          <div class="page-actions">
            <button class="btn" id="btnAddUser">ุฅุถุงูุฉ ูุณุชุฎุฏู</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">ูุงุฆูุฉ ุงููุณุชุฎุฏููู</div>
            <div class="panel-actions">
              <button class="chip" id="btnReloadUsers">ุชุญุฏูุซ</button>
            </div>
          </div>
          <div class="panel-body">
            <div id="usersList"></div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-head"><div class="panel-title">ููุงุญุธุงุช</div></div>
          <div class="panel-body prose">
            <ul>
              <li><b>Admin</b>: ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู + ูู ุงูุตูุงุญูุงุช.</li>
              <li><b>Viewer</b>: ุนุฑุถ ููุท.</li>
            </ul>
            <div class="muted small">ูุชุญููู ุฃูู ูุณุชุฎุฏู ุฅูู Admin: ุงูุชุญ Firestore โ users โ ูุณุชูุฏ UID ุงูุฎุงุต ุจู โ ุบููุฑ role ุฅูู Admin.</div>
          </div>
        </div>
      </section>


      <section class="view" id="view-customers">
        <div class="page-head">
          <h1>ุงูุนููุงุก</h1>
          <div class="page-actions">
            <button class="btn" id="btnAddCustomer">ุฅุถุงูุฉ ุนููู</button>
          </div>
        </div>

        <div class="filters">
          <div class="field">
            <label>ุจุญุซ</label>
            <input id="qCustomer" type="search" placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงููุฏููุฉ ุฃู ุงููุงุชูโฆ" />
          </div>
          <div class="field">
            <label>ุงููุฏููุฉ</label>
            <select id="fCity"><option value="">ุงููู</option></select>
          </div>
          <div class="field">
            <label>ุงูุญุงูุฉ</label>
            <select id="fStatus">
              <option value="">ุงููู</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="field">
            <label>ุงููุฌูู</label>
            <select id="fStars">
              <option value="">ุงููู</option>
              <option value="5">โญโญโญโญโญ</option>
              <option value="4">โญโญโญโญ</option>
              <option value="3">โญโญโญ</option>
              <option value="2">โญโญ</option>
              <option value="1">โญ</option>
            </select>
          </div>
          <div class="field">
            <label>ุชุฑุชูุจ</label>
            <select id="sSort">
              <option value="score_desc">ุงูุฃุนูู ุชูููููุง</option>
              <option value="name_asc">ุงูุงุณู (ุฃ-ู)</option>
              <option value="created_desc">ุงูุฃุญุฏุซ</option>
            </select>
          </div>
        </div>

        <div class="grid" id="customersGrid"></div>
        <div class="center muted" id="customersEmpty" hidden>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง.</div>
      </section>

      <section class="view" id="view-customer">
        <div class="page-head">
          <button class="btn ghost" id="btnBack">โฌ ุฑุฌูุน</button>
          <h1 id="custName">ุชูุงุตูู ุงูุนููู</h1>
          <div class="page-actions">
            <button class="btn danger" id="btnDeleteCustomer">ุญุฐู</button>
          </div>
        </div>

        <div class="cards" id="custSummaryCards"></div>

        <div class="panel">
          <div class="panel-head"><div class="panel-title">ุฅุฌุฑุงุกุงุช</div></div>
          <div class="panel-body row">
            <button class="btn" id="btnAddTxn">ุฅุถุงูุฉ ุญุฑูุฉ</button>
            <button class="btn" id="btnViewInvoices">ุนุฑุถ ุงูููุงุชูุฑ</button>
            <button class="btn" id="btnPrintCustomer">ุทุจุงุนุฉ / PDF</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">ุญุฑูุงุช ุงูุนููู</div>
            <div class="panel-actions">
              <input id="custDateFrom" type="date" />
              <input id="custDateTo" type="date" />
              <button class="chip" id="btnCustFilterDate">ููุชุฑุฉ</button>
            </div>
          </div>
          <div class="panel-body">
            <div class="tabs">
              <button class="tab active" data-tab="sales">ุงููุจูุนุงุช</button>
              <button class="tab" data-tab="returns">ุงููุฑุชุฌุนุงุช</button>
              <button class="tab" data-tab="payments">ุงูุณุฏุงุฏ</button>
              <button class="tab" data-tab="discounts">ุงูุฎุตููุงุช</button>
            </div>
            <div id="custTxns"></div>
          </div>
        </div>
      </section>

      <section class="view" id="view-transactions">
        <div class="page-head">
          <h1>ุงูุญุฑูุงุช</h1>
          <div class="page-actions"><button class="btn" id="btnAddGlobalTxn">ุฅุถุงูุฉ ุญุฑูุฉ</button></div>
        </div>
        <div class="filters">
          <div class="field">
            <label>ููุน ุงูุญุฑูุฉ</label>
            <select id="gTxnType">
              <option value="sales">Sales</option>
              <option value="returns">Returns</option>
              <option value="payments">Payments</option>
              <option value="discounts">Discounts</option>
            </select>
          </div>
          <div class="field"><label>ุนููู</label><select id="gCustomer"></select></div>
          <div class="field"><label>ูู ุชุงุฑูุฎ</label><input id="gFrom" type="date" /></div>
          <div class="field"><label>ุฅูู ุชุงุฑูุฎ</label><input id="gTo" type="date" /></div>
          <div class="field"><label>&nbsp;</label><button class="btn" id="btnLoadGlobalTxns">ุนุฑุถ</button></div>
        </div>
        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">ุงููุชุงุฆุฌ</div>
            <div class="panel-actions"><button class="chip" id="btnPrintGlobalTxns">ุทุจุงุนุฉ</button></div>
          </div>
          <div class="panel-body"><div id="globalTxns"></div></div>
        </div>
      </section>

      <section class="view" id="view-invoices">
        <div class="page-head">
          <h1>ุงูููุงุชูุฑ</h1>
          <div class="page-actions">
            <button class="btn" id="btnRecalcInvoices">ุชุญุฏูุซ</button>
            <button class="btn" id="btnPrintInvoices">ุทุจุงุนุฉ</button>
          </div>
        </div>
        <div class="filters">
          <div class="field"><label>ุนููู</label><select id="invCustomer"></select></div>
          <div class="field"><label>ุจุญุซ ุฑูู ูุงุชูุฑุฉ</label><input id="invQuery" type="search" placeholder="S-1001 โฆ" /></div>
          <div class="field"><label>ูู ุชุงุฑูุฎ</label><input id="invFrom" type="date" /></div>
          <div class="field"><label>ุฅูู ุชุงุฑูุฎ</label><input id="invTo" type="date" /></div>
          <div class="field"><label>&nbsp;</label><button class="btn" id="btnLoadInvoices">ุนุฑุถ</button></div>
        </div>
        <div class="grid" id="invoicesGrid"></div>
        <div class="center muted" id="invoicesEmpty" hidden>ูุง ุชูุฌุฏ ููุงุชูุฑ.</div>
      </section>

      <section class="view" id="view-company">
        <div class="page-head">
          <h1>ุจูุงูุงุช ุงูุดุฑูุฉ</h1>
          <div class="page-actions"><button class="btn" id="btnSaveCompany">ุญูุธ</button></div>
        </div>
        <div class="panel">
          <div class="panel-head"><div class="panel-title">ุงููุนูููุงุช</div></div>
          <div class="panel-body grid2">
            <div class="field"><label>ุงุณู ุงูุดุฑูุฉ</label><input id="coName" type="text" placeholder="ุดุฑูุฉ ุงูููุฑ" /></div>
            <div class="field"><label>ูุงุชู</label><input id="coPhone" type="text" placeholder="010โฆ" /></div>
            <div class="field"><label>ุงูุนููุงู</label><input id="coAddress" type="text" placeholder="ุงููุงูุฑุฉโฆ" /></div>
            <div class="field"><label>ุดุนุงุฑ (ุฑุงุจุท)</label><input id="coLogo" type="url" placeholder="https://โฆ" /></div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-head"><div class="panel-title">ูุนุงููุฉ ุงูุทุจุงุนุฉ</div></div>
          <div class="panel-body"><div class="print-preview" id="companyPreview"></div></div>
        </div>
      </section>

      <section class="view" id="view-tools">
        <div class="page-head">
          <h1>ุงุณุชูุฑุงุฏ / ุชุตุฏูุฑ Excel</h1>
          <div class="page-actions"><button class="btn" id="btnExport">ุชุตุฏูุฑ Excel</button></div>
        </div>
        <div class="panel">
          <div class="panel-head"><div class="panel-title">ุงุณุชูุฑุงุฏ Excel</div></div>
          <div class="panel-body">
            <div class="muted small">Sheets: customers, sales, returns, payments, discounts</div>
            <div class="row">
              <input type="file" id="fileExcel" accept=".xlsx,.xls" />
              <button class="btn" id="btnImport">ุงุณุชูุฑุงุฏ</button>
            </div>
            <div class="muted small" id="importLog"></div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-head"><div class="panel-title">ููุงูุจ ุณุฑูุนุฉ</div></div>
          <div class="panel-body row">
            <button class="btn ghost" id="btnDownloadTemplate">ุชุญููู ูุงูุจ Excel</button>
            <button class="btn ghost" id="btnSeedDemo">ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ</button>
            <button class="btn ghost" id="btnClearAll">ูุณุญ ูู ุงูุจูุงูุงุช</button>
          </div>
        </div>
      </section>

      <section class="view" id="view-about">
        <div class="page-head"><h1>ุญูู</h1></div>
        <div class="panel"><div class="panel-body prose">
          <p>ุชุทุจูู ููุจุงูู ุฎููู (Web) ูุชูููู ุงูุนููุงุก ุชููุงุฆููุง ุจูุงุกู ุนูู ุงููุจูุนุงุช/ุงููุฑุชุฌุนุงุช/ุงูุณุฏุงุฏ/ุงูุฎุตููุงุช ูุน ูุฌูู ูุจุญุซ/ููุชุฑุฉ.</p>
          <ul><li>Firestore</li><li>Excel Import/Export</li><li>Print/PDF</li><li>Company Info</li></ul>
          <div class="muted small">v1.0 โ 2026-02-07</div>
        </div></div>
      </section>
    </main>

    <div class="modal" id="modal" hidden>
      <div class="modal-backdrop" id="modalBackdrop"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-head">
          <div class="modal-title" id="modalTitle">ุนููุงู</div>
          <button class="icon-btn" id="modalClose" aria-label="ุฅุบูุงู">โ</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-foot" id="modalFoot"></div>
      </div>
    </div>

    <div class="toast" id="toast" hidden></div>
    <div class="print-area" id="printArea" aria-hidden="true"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
